<div class="container mt-4">
  <h4>Manage Pages</h4>
  <div *ngIf="loading" class="alert alert-info">Loading...</div>
  <div *ngIf="error" class="alert alert-danger">{{ error }}</div>
  <div *ngIf="info" class="alert alert-secondary">{{ info }}</div>

  <div class="row g-3 align-items-end admin-pages-grid">
    <div class="col-sm-4">
      <label class="form-label">Slug</label>
      <input class="form-control" [(ngModel)]="current.slug" (blur)="onSlugBlur()" placeholder="e.g. about-us" />
      <small class="text-muted">Lowercase, hyphen-separated. This becomes the URL.</small>
    </div>
    <div class="col-sm-4">
      <label class="form-label">Title</label>
      <input class="form-control" [(ngModel)]="current.title" placeholder="Page title" />
    </div>
    <div class="col-sm-4 d-flex gap-2">
      <button class="btn btn-success" type="button" (click)="save()" [disabled]="saving || !current.slug || !current.title">
        {{ saving ? 'Saving...' : 'Save' }}
      </button>
      <button class="btn btn-outline-secondary" type="button" (click)="newPage()">New page</button>
    </div>
  </div>

  <div class="mt-3">
    <label class="form-label">Content</label>
    <textarea class="form-control" rows="10" [(ngModel)]="current.content" placeholder="Page content"></textarea>
  </div>

  <div class="mt-3">
    <label class="form-label">Gallery Images</label>
    <div class="d-flex flex-wrap gap-2 mb-2" *ngIf="current.images?.length">
      <div class="position-relative" *ngFor="let img of current.images">
        <img [src]="img" class="img-thumbnail" style="width: 120px; height: 90px; object-fit: cover" alt="gallery" />
        <button type="button" class="btn-close position-absolute top-0 end-0" aria-label="Remove" (click)="removeImage(img)"></button>
      </div>
    </div>
    <div class="input-group mb-2">
      <input #imgUrl class="form-control" placeholder="Paste image URL" />
      <button class="btn btn-outline-secondary" type="button" (click)="addImageUrl(imgUrl.value); imgUrl.value=''">Add URL</button>
    </div>
    <div class="mb-2">
      <input type="file" class="form-control" (change)="onImageFileSelected($event)" />
      <div *ngIf="uploadError" class="text-danger small mt-1">{{ uploadError }}</div>
      <div *ngIf="uploading" class="text-muted small mt-1">Uploading...</div>
    </div>
  </div>

  <div class="mt-3">
    <h6>Existing pages</h6>
    <ul class="list-group">
      <li class="list-group-item d-flex justify-content-between align-items-center" *ngFor="let p of pages">
        <span>{{ p.title }} ({{ p.slug }})</span>
        <div class="d-flex gap-2">
          <button class="btn btn-outline-primary btn-sm" type="button" (click)="edit(p)">Edit</button>
          <button class="btn btn-outline-danger btn-sm" type="button" (click)="remove(p.slug)">Delete</button>
        </div>
      </li>
    </ul>
  </div>
</div>
